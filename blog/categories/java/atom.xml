<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: java | Ajia's Blog]]></title>
  <link href="http://ajia.github.com/blog/categories/java/atom.xml" rel="self"/>
  <link href="http://ajia.github.com/"/>
  <updated>2013-04-08T18:07:41+08:00</updated>
  <id>http://ajia.github.com/</id>
  <author>
    <name><![CDATA[Ajia]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[jquery的jsonp方式的ajax提交解决跨域的问题]]></title>
    <link href="http://ajia.github.com/blog/2013/04/08/jqueryde-jsonpfang-shi-de-ajaxti-jiao-jie-jue-kua-yu-de-wen-ti/"/>
    <updated>2013-04-08T17:45:00+08:00</updated>
    <id>http://ajia.github.com/blog/2013/04/08/jqueryde-jsonpfang-shi-de-ajaxti-jiao-jie-jue-kua-yu-de-wen-ti</id>
    <content type="html"><![CDATA[<p>jquery请求：
```javascript</p>

<pre><code>var action = form.attr("action");
$.ajax({  
    type:"get",  
    data: {  
        mobile : $('#mobile'+id).val()  
    },  
    url:action,  
    dataType:"jsonp",  
    jsonp:"callback",  
    success:function(data){
        var res = eval(data);
        if(res.resultObj.result){
            alert("发送成功");
        }
    }  
}); 
</code></pre>

<p>```</p>

<p>服务器端：
```java</p>

<pre><code>response.setContentType("text/html; charset=utf-8");
response.setHeader("Pragma", "No-cache");
response.setDateHeader("Expires", 0);
response.setHeader("Cache-Control", "no-cache");
PrintWriter out = response.getWriter();
//业务逻辑
String callback = request.getParameter("callback");
        result = callback+"("+resultJson.toString()+")";
out.print(result);
out.flush();
out.close();
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[遇上MySql的奇怪问题]]></title>
    <link href="http://ajia.github.com/blog/2013/04/08/yu-shang-mysqlde-qi-guai-wen-ti/"/>
    <updated>2013-04-08T17:25:00+08:00</updated>
    <id>http://ajia.github.com/blog/2013/04/08/yu-shang-mysqlde-qi-guai-wen-ti</id>
    <content type="html"><![CDATA[<p>今天遇上一个异常：<br/>
```
2013-04-08 15:35:47 072 [ERROR] JDBC commit failed [org.hibernate.transaction.JDBCTransaction.commit(JDBCTransaction.java:124)]
com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Communications link failure during commit(). Transaction resolution unknown.</p>

<pre><code>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
at java.lang.reflect.Constructor.newInstance(Constructor.java:532)
at com.mysql.jdbc.Util.handleNewInstance(Util.java:407)
at com.mysql.jdbc.Util.getInstance(Util.java:382)
at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1013)
at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:987)
at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:982)
at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:927)
at com.mysql.jdbc.ConnectionImpl.commit(ConnectionImpl.java:1672)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:616)
at org.logicalcobwebs.proxool.WrappedConnection.invoke(WrappedConnection.java:162)
at org.logicalcobwebs.proxool.WrappedConnection.intercept(WrappedConnection.java:87)
at $java.sql.Connection$$EnhancerByProxool$$90ddbb0c.commit(&lt;generated&gt;)
at org.hibernate.transaction.JDBCTransaction.commitAndResetAutoCommit(JDBCTransaction.java:139)
at org.hibernate.transaction.JDBCTransaction.commit(JDBCTransaction.java:115)
at org.springframework.orm.hibernate3.HibernateTransactionManager.doCommit(HibernateTransactionManager.java:596)
at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:709)
at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:678)
at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:319)
at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:116)
at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)
at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
at $Proxy163.importDate(Unknown Source)
</code></pre>

<p>```
找了一个上午和半个下午终于解决了，原因是线上的数据库服务器关掉了innodb引擎，myisam对事务支持有问题，所以修改spring的配置文件，把事务的配置去掉就可以了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HttpClient上传文件]]></title>
    <link href="http://ajia.github.com/blog/2013/04/07/httpclientshang-chuan-wen-jian/"/>
    <updated>2013-04-07T21:44:00+08:00</updated>
    <id>http://ajia.github.com/blog/2013/04/07/httpclientshang-chuan-wen-jian</id>
    <content type="html"><![CDATA[<p>折腾了一下用HttpClient上传文件，主要是不需要设置“multipart/form-data”,否则会出现“the request was rejected because no multipart boundary was found”
```java</p>

<pre><code>PostMethod method = new PostMethod(url); 
    Part[] part = new Part[params.size()+1];
    Set&lt;String&gt; keySet = params.keySet();
    int i=0;
    for(String key : keySet) {
        String value = params.get(key);
        if(StringUtil.isNotNull(value)){
            part[i] = new StringPart(key, value, "UTF-8");
        }else{
            part[i] = new StringPart(key, "", "UTF-8");
        }
        i++;
    }
    FilePart fp = new  FilePart("image", file);
    fp.setContentType(MIME.ENC_BINARY);
    part[i] = fp;
    HttpConnectionManagerParams managerParams = httpClient.getHttpConnectionManager().getParams();
    managerParams.setConnectionTimeout(3000000);
     managerParams.setSoTimeout(12000000);
    int statusCode;
    try {
        MultipartRequestEntity mrp= new  MultipartRequestEntity(part, method.getParams());  
        method.setRequestEntity(mrp);
        statusCode = httpClient.executeMethod(method);
        if(statusCode != HttpStatus.SC_OK){
            log.error("Method failed code=" + statusCode + ": " + method.getStatusLine());
        }else{
            InputStream inputStream = method.getResponseBodyAsStream();  
            BufferedReader br = new BufferedReader(new InputStreamReader(inputStream, "UTF-8"));  
            String str= "";  
            while((str = br.readLine()) != null){   
                response .append(str);  
            }   
        }
    } catch (HttpException e) {
        log.error(e.getMessage(), e);
    } catch (IOException e) {
        log.error(e.getMessage(), e);
    } finally{
        method.releaseConnection();
    }
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[java中替换掉换行符]]></title>
    <link href="http://ajia.github.com/blog/2013/03/25/ti-huan-diao-slash-n/"/>
    <updated>2013-03-25T14:14:00+08:00</updated>
    <id>http://ajia.github.com/blog/2013/03/25/ti-huan-diao-slash-n</id>
    <content type="html"><![CDATA[<p>问题：要替换掉内容中出现的“\n”，写成</p>

<pre><code>str.replace("\\n", "")  
</code></pre>

<p>才能正确执行。
下面的都不能替换掉</p>

<pre><code>str.replace("\n","") 
str.replaceAll("\\n","")
str.replaceAll("\n","")
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决cookie中文出现乱码的问题]]></title>
    <link href="http://ajia.github.com/blog/2013/03/22/jie-jue-cookiezhong-wen-chu-xian-luan-ma-de-wen-ti/"/>
    <updated>2013-03-22T14:13:00+08:00</updated>
    <id>http://ajia.github.com/blog/2013/03/22/jie-jue-cookiezhong-wen-chu-xian-luan-ma-de-wen-ti</id>
    <content type="html"><![CDATA[<p>```java code http://ajia.github.com ajia</p>

<pre><code>String value = java.net.URLEncoder.encode("中文","utf-8");
Cookie cookie = new Cookie("chinese_code",value);
cookie.setMaxAge(60*60*24*6);
response.addCookie(cookie);
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
</feed>
